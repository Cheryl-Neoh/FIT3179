{
  "$schema": "https://vega.github.io/schema/vega-lite/v4.json",
  "params": [
    {
      "name": "Current_Type",
      "value": "All Crime",
      "bind": {
        "input": "select",
        "options": [
          "All Crime",
          "Murder",
          "Rape",
          "Robbery",
          "Harming",
          "Theft",
          "Drug addicts",
          "House break-ins"
        ],
        "name": "Type of crime: "
      }
    }
  ],
  "data": {
    "url": "https://cheryl-neoh.github.io/FIT3179/Assignment 2/Data/AllYearCrimeRates.csv"
  },
  "width": 150,
  "height": 350,
  "transform": [
    {
      "sort": [{"field": "Rate per 100,000 people", "order": "descending"},
              {"field": "Total cases", "order": "descending"}],
      "window": [{"op": "rank", "as": "rank"}],
      "groupby": ["Year", "Type"]
    },
    {"filter": "datum.Type == Current_Type"}
  ],
  "encoding": {
    "x": {"field": "Year", "type": "ordinal"},
    "y": {
      "field": "rank",
      "type": "ordinal"
    }
  },
  "layer": [
    {
      "mark": "line",
      "selection": {
        "highlight1": {
          "type": "multi",
          "fields": ["id"]
        }
      },
      "encoding": {
        "color": {"field": "id", "type": "nominal"},
        "opacity": {
          "condition": {"selection": "highlight1", "value": 0.8},
          "value": 0.1
        }
      }
    },
    {
      "mark": {"type": "rule", "orient": "vertical"},
      "selection": {
        "hover": {
          "type": "single",
          "fields": ["Year"],
          "nearest": true,
          "on": "mouseover",
          "empty": "none",
          "clear": "mouseout"
        },
        "highlight": {
          "type": "multi",
          "fields": ["id"]
        }
      },
      "encoding": {
        "color": {"field": "id", "type": "nominal"},
        "tooltip": [
          {"field": "id", "type": "nominal", "title": "State"},
          {"field": "Year", "type": "nominal"},
          {"field": "rank", "type": "nominal", "title": "Rank"}
        ],
        "opacity": {
          "condition": {"value": 1, "selection": "hover"},
          "value": 0
        }
      }
    },
    {
      "mark": {"type": "circle", "orient": "vertical"},
      "encoding": {
        "color": {
          "field": "id",
          "type": "nominal",
          "legend": null
        },
        "opacity": {
          "condition": {"selection": "highlight", "value": 0.8},
          "value": 0.1
        }
      },
      "title": {
        "text": "Most unsafe state in Malaysia according to rank",
        "fontSize": 18,
        "offset": 20
      }
    },
    {
      "mark": {
        "type": "text",
        "align": "left",
        "dx": 10,
        "fontStyle": "italic"
      },
      "encoding": {
        "text": { "field": "id"},
        "opacity":{
          "condition": {
            "selection": "highlight", "value": 1},
            "value": 0.2
        },
        "fillOpacity":{
          "condition": {
            "test": "datum.Year == 2019", "value": 1},
            "value": 0
        }
      }
    }
  ],
  "config": {
    "background": "snow",
    "style": {
      "cell": {
        "stroke": "transparent"
      }
    },
    "line": {
      "strokeWidth": 4
    },
    "circle": {
      "size": 100
    }
  }
}
